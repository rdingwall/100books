<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!-- Use these if TeamCity vars aren't set -->
    <build_vcs_number Condition ="$(build_vcs_number) == ''">xxx</build_vcs_number>
    <build_number Condition="$(build_number) == ''">0.0.0.0</build_number>
    <teamcity_agent_work_dir Condition="$(teamcity_agent_work_dir) == ''">C:\dev\100books</teamcity_agent_work_dir>

    <MSBuildCommunityTasksPath>$(teamcity_agent_work_dir)\r1\Ohb\packages\MSBuildTasks.1.3.0.528\lib\net20</MSBuildCommunityTasksPath>
  </PropertyGroup>

  <Import Project="$(MSBuildCommunityTasksPath)\MSBuild.Community.Tasks.Targets"/>

  <Target Name="ContinuousBuild" DependsOnTargets="GenerateAssemblyInfo">
    <MSBuild Projects="..\Ohb.sln" Targets="Rebuild" Properties="Configuration=Debug;RestorePackages=false;" />
  </Target>

  <Target Name="GenerateAssemblyInfo">
    <Message Text="Using AssemblyConfiguration = $(build_vcs_number)" />
    <Message Text="Using AssemblyVersion = $(build_number)" />
    <!-- Using AssemblyConfiguration as git commit hash -->
    <AssemblyInfo CodeLanguage="CS"
      OutputFile="..\SolutionInfo.cs"
      AssemblyCompany="100 Books"
      AssemblyProduct="100 Books"
      AssemblyConfiguration="$(build_vcs_number)"
      AssemblyCopyright="Copyright Â© Richard Dingwall / 100 Books 2012"
      AssemblyVersion="$(build_number)"
      AssemblyFileVersion="$(build_number)" />
  </Target>

  <!-- Deploy website for tests -->
  <Target Name="TeamCityDeploy" DependsOnTargets="GenerateAssemblyInfo">
    <MSBuild Projects="..\Ohb.sln" Targets="Rebuild" Properties="Configuration=TeamCityDeploy;RestorePackages=false;" />
  </Target>

</Project>
