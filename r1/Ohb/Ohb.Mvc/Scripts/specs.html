<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.1.3/less-1.1.3.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js" type="text/javascript"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/modernizr/1.7/modernizr-1.7.min.js"
        type="text/javascript"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js"
        type="text/javascript"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js" type="text/javascript"></script>
    <script src="https://raw.github.com/andyet/ICanHaz.js/master/ICanHaz.min.js" type="text/javascript"></script>
    <script src="ohb.js" type="text/javascript"></script>
    <script type="text/javascript" src="sinon-1.2.0.js"></script>
    <script type="text/javascript" src="jasmine-standalone-1.1.0/jasmine.js"></script>
    <script type="text/javascript" src="jasmine-standalone-1.1.0/jasmine-html.js"></script>
    <link rel="stylesheet" href="jasmine-standalone-1.1.0/jasmine.css">
    <script type="text/javascript">

        function assertBookMapping(googleBookId, title, authors, smallThumbnailUrl) {
            $.getJSON('https://www.googleapis.com/books/v1/volumes/' + googleBookId + '?callback=?',
                function (data) {
                    var searchResult = SearchResult.fromGoogle(data);

                    start();

                    expect(searchResult.get('title')).toEqual(title);
                    expect(searchResult.get('authors')).toEqual(authors);
                    expect(searchResult.get('smallThumbnailUrl')).toEqual(smallThumbnailUrl);
                })
                .error(function () {
                    start();
                    throw "failed";
                });

            stop();

            expect(3);
        }


        describe("When searching for books", function () {

            describe("When the book has no authors", function () {

                beforeEach(function () {
                    this.xhr = sinon.useFakeXMLHttpRequest();
                    var requests = this.requests = [];

                });

                it("should map the book correctly", function () {



                    assertBookMapping('3zgFSQAACAAJ',
                        "The Girl With the Dragon Tattoo",
                        null,
                        "http://bks1.books.google.co.uk/books?id=3zgFSQAACAAJ&printsec=frontcover&img=1&zoom=5&source=gbs_api");

                    this.requests[0].respond(200, { "Content-Type": "application/json" },
                                 '[{ id: 12, comment: "Hey there" }]');
                    
                
                });

                afterEach(function () {
                    this.xhr.restore();
                });
            });

            describe("When the book has no thumbnails", function () {
                it("should map the book correctly", function () {
                    assertBookMapping('_XDFAAAACAAJ',
                    "Design Patterns: Elements of Reusable Object-Oriented Software with Applying Uml and Patterns:An Introduction to Object-Oriented Analysis and Design and the Unified Process",
                    "Gamma, Larman",
                    null);
                });
            });

            describe("When the book has multiple authors", function () {
                it("should map the book correctly", function () {
                    assertBookMapping('GGpXN9SMELMC',
                        "Head First design patterns",
                        "Eric Freeman, Elisabeth Freeman, Kathy Sierra, Bert Bates",
                        "http://bks9.books.google.co.uk/books?id=GGpXN9SMELMC&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api");
                });
            });

            describe("When the book has a subtitle", function () {
                it("should map the book correctly", function () {
                    assertBookMapping('abYKXvCwEToC',
                        "Harry Potter: the story of a global business phenomenon",
                        "Susan Gunelius",
                        "http://bks6.books.google.co.uk/books?id=abYKXvCwEToC&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api");
                });
            });


        }); 
    </script>
</head>
<body>
    <script>
        jasmine.getEnv().addReporter(new jasmine.TrivialReporter());
        jasmine.getEnv().execute(); 
    </script>
</body>
</html>
